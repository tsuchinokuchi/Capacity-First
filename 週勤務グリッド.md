# ğŸ—“ é€±å‹¤å‹™ã‚°ãƒªãƒƒãƒ‰ï¼ˆå‹¤å‹™/ä¼‘ã¿ã ã‘ï¼‰

```dataviewjs
// è¨­å®š
const src = "03.ãƒ„ã‚§ãƒƒãƒ†ãƒ«ã‚«ã‚¹ãƒ†ãƒ³/030.ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹/ã‚¿ã‚¹ã‚¯ç®¡ç†/ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«"; // å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€
const workKeywords = [/å‹¤å‹™/, /å‡ºå‹¤/];
const offKeywords = [/ä¼‘ã¿/, /ä¼‘æ—¥/, /æœ‰çµ¦/];

// DOM
const host = dv.container;
host.innerHTML = '';

// é€±ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆ0=ä»Šé€±ï¼‰
let offset = 0;

const btnStyle = 'padding:6px 10px; border:1px solid var(--background-modifier-border); border-radius:6px; background:var(--background-secondary); cursor:pointer; margin-right:6px; -webkit-tap-highlight-color:transparent;';

const header = document.createElement('div');
header.style.cssText = 'display:flex; align-items:center; gap:8px; margin-bottom:8px;';
const prevBtn = document.createElement('button'); prevBtn.textContent = 'â† å‰é€±'; prevBtn.style.cssText = btnStyle;
const nextBtn = document.createElement('button'); nextBtn.textContent = 'æ¬¡é€± â†’'; nextBtn.style.cssText = btnStyle;
const title = document.createElement('div'); title.style.cssText = 'font-weight:600;';
header.appendChild(prevBtn); header.appendChild(nextBtn); header.appendChild(title);
host.appendChild(header);

const tableWrap = document.createElement('div');
host.appendChild(tableWrap);

function parseTimeRangeFromText(text){
  const m = text.match(/(\d{2}:\d{2})-(\d{2}:\d{2})/);
  return m ? { start: m[1], end: m[2] } : null;
}

function mergeRanges(ranges){
  if (ranges.length === 0) return '';
  const starts = ranges.map(r=>r.start).sort();
  const ends = ranges.map(r=>r.end).sort();
  return `${starts[0]}-${ends[ends.length-1]}`;
}

function extractStatusAndTime(tasks){
  // å„ªå…ˆ: å‹¤å‹™ > ä¼‘ã¿ > ç©º
  const workMatches = tasks.filter(t => workKeywords.some(r=>r.test(t.text)));
  if (workMatches.length){
    const ranges = workMatches.map(t => parseTimeRangeFromText(t.text)).filter(Boolean);
    const time = mergeRanges(ranges);
    return { label: 'å‹¤å‹™', time };
  }
  const offMatches = tasks.filter(t => offKeywords.some(r=>r.test(t.text)));
  if (offMatches.length){
    const ranges = offMatches.map(t => parseTimeRangeFromText(t.text)).filter(Boolean);
    const time = mergeRanges(ranges);
    return { label: 'ä¼‘ã¿', time };
  }
  return { label: '', time: '' };
}

function listForDate(dateTs){
  const pages = dv.pages(`"${src}"`);
  const dayTasks = pages.file.tasks
    .where(t => /^\d{2}:\d{2}-/.test(t.text))
    .where(t => {
      const ts = t.due?.ts ?? t.scheduled?.ts ?? 0;
      return ts >= dateTs && ts < dateTs + 86400000;
    })
    .array();
  return dayTasks;
}

function render(){
  tableWrap.innerHTML = '';
  const start = moment().startOf('week').add(1,'day').add(offset,'weeks'); // æœˆæ›œ
  if (start.day() !== 1) start.subtract((start.day()+6)%7, 'day');
  title.textContent = `${start.format('YYYY/MM/DD')} ã€œ ${moment(start).add(6,'days').format('MM/DD')}`;

  const table = document.createElement('table');
  table.style.cssText = 'width:100%; border-collapse:collapse;';
  const thead = document.createElement('thead');
  const headRow = document.createElement('tr');
  const days = ['æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ','æ—¥'];
  for (const d of days){
    const th = document.createElement('th');
    th.textContent = d;
    th.style.cssText = 'padding:6px; border-bottom:1px solid var(--background-modifier-border); text-align:left;';
    headRow.appendChild(th);
  }
  thead.appendChild(headRow); table.appendChild(thead);

  const tbody = document.createElement('tbody');
  const row = document.createElement('tr');
  for (let i=0;i<7;i++){
    const day = moment(start).add(i,'days');
    const td = document.createElement('td');
    td.style.cssText = 'padding:8px; vertical-align:top; border-bottom:1px dashed var(--background-modifier-border);';
    const date = document.createElement('div');
    date.style.cssText = 'font-size:0.9em; opacity:.8; margin-bottom:4px;';
    date.textContent = day.format('M/D');
    const tasks = listForDate(day.startOf('day').valueOf());
    const info = extractStatusAndTime(tasks);
    const label = document.createElement('div');
    label.textContent = (info.label || 'â€”') + (info.time ? ` ${info.time}` : '');
    label.style.cssText = `font-weight:600; ${info.label==='å‹¤å‹™'?'color:var(--text-accent);':''}`;
    td.appendChild(date); td.appendChild(label);
    row.appendChild(td);
  }
  tbody.appendChild(row); table.appendChild(tbody);
  tableWrap.appendChild(table);
}

prevBtn.addEventListener('click', ()=>{ offset--; render(); });
nextBtn.addEventListener('click', ()=>{ offset++; render(); });

render();
```


