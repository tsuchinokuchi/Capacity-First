# Phase 3: 繰り返しタスク展開 設定手順

## 概要

Phase 3では、毎日・毎週・毎月の繰り返しタスクを自動的に展開する機能を実装しました。

## 実装内容

### 1. 繰り返しタスク展開スクリプト

- **ファイル**: `03.ツェッテルカステン/030.データベース/タスク管理/scripts/繰り返しタスク展開.js`
- **機能**: 
  - 毎日・毎週・毎月の繰り返しタスク定義ファイルを読み込む
  - 出勤日リストを取得して、出勤日にのみタスクを展開
  - 既に存在するタスクはスキップ

### 2. QuickAddコマンド追加

- **コマンド名**: 「QuickAdd: 繰り返しタスク展開」
- **使い方**: コマンドパレットから実行

## 繰り返しタスク定義ファイル

### 毎日のタスク (`毎日.md`)

```markdown
- [ ] タスク名 #ジャンル ⏱️ 60 🔁 every day
```

例:
```markdown
- [ ] 朝支度 #健康 ⏱️ 30 🔁 every day
- [ ] 夕食準備 #プライベート ⏱️ 45 🔁 every day
```

### 毎週のタスク (`毎週.md`)

```markdown
- [ ] タスク名 #ジャンル ⏱️ 60 🔁 every Monday
```

対応する曜日:
- `every Monday` (月曜日)
- `every Tuesday` (火曜日)
- `every Wednesday` (水曜日)
- `every Thursday` (木曜日)
- `every Friday` (金曜日)
- `every Saturday` (土曜日)
- `every Sunday` (日曜日)

例:
```markdown
- [ ] 週次MTG #デスクワーク ⏱️ 60 🔁 every Monday
- [ ] 週報作成 #定型作業 ⏱️ 30 🔁 every Friday
```

### 毎月のタスク (`毎月.md`)

```markdown
- [ ] タスク名 #ジャンル ⏱️ 60 🔁 every month on the 1st
```

例:
```markdown
- [ ] 月次レポート #定型作業 ⏱️ 90 🔁 every month on the 1st
- [ ] 請求処理 #定型作業 ⏱️ 60 🔁 every month on the 15th
```

## 使い方

### 1. 繰り返しタスクを定義

各繰り返しタスク定義ファイル（`毎日.md`、`毎週.md`、`毎月.md`）にタスクを追加します。

### 2. 繰り返しタスク展開を実行

1. コマンドパレット（`Ctrl+P`）を開く
2. 「QuickAdd: 繰り返しタスク展開」を選択
3. 展開期間を選択:
   - 今週（7日間）
   - 来週（7日間）
   - 2週間（14日間）
   - 今月（月末まで）

### 3. 結果確認

- 展開されたタスク数とスキップされたタスク数が通知されます
- スケジュールフォルダの各日付ファイルにタスクが追加されます

## 動作仕様

### 出勤日連動

- 繰り返しタスクは**出勤日のみ**に展開されます
- 出勤日は、スケジュールフォルダの各日付ファイルに「勤務」や「出勤」を含むタスクがあるかで判定されます

### 重複チェック

- 既に同じタスクが存在する場合はスキップされます
- タスク名で判定します（メタデータを除く）

### 完了済みタスクの処理

- 繰り返しタスク定義ファイルで完了済み（`- [x]`）のタスクは展開されません

## 注意事項

1. **週勤務グリッドの更新**: 出勤日を正しく判定するため、スケジュールファイルに「勤務」や「出勤」を含むタスクを事前に登録しておく必要があります

2. **タスクフォーマット**: 繰り返しタスク定義ファイルのタスクは、以下のフォーマットに従ってください:
   - `- [ ] タスク名 #ジャンル ⏱️ 時間 🔁 繰り返しパターン`

3. **展開タイミング**: 
   - 週始め（月曜日）に手動で実行することを推奨
   - または、必要に応じて手動で実行

## トラブルシューティング

### タスクが展開されない

1. 繰り返しタスク定義ファイルにタスクが正しく定義されているか確認
2. 出勤日が正しく設定されているか確認（スケジュールファイルに「勤務」や「出勤」を含むタスクがあるか）
3. 既に同じタスクが存在していないか確認

### エラーが出る

- コンソール（`Ctrl+Shift+I`）でエラーメッセージを確認
- ファイルパスが正しいか確認
- タスクフォーマットが正しいか確認

## 今後の改善予定

- [ ] 自動展開機能（週始めに自動実行）
- [ ] スキップ機能（今週だけスキップ）
- [ ] 例外日設定（特定の日は展開しない）

