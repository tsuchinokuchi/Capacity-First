# ğŸ› ï¸ Capacity-first å®Ÿè£…ãƒ—ãƒ©ãƒ³

## 1. å®Ÿè£…ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 1.1 ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

#### ã‚¿ã‚¹ã‚¯ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆTasksãƒ—ãƒ©ã‚°ã‚¤ãƒ³å½¢å¼ï¼‰
```markdown
- [ ] ã‚¿ã‚¹ã‚¯å #ã‚¸ãƒ£ãƒ³ãƒ« #ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå â±ï¸ 60 ğŸ“… 2025-11-01
```

#### ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆTasksãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼‰
- `â±ï¸` (æ‰€è¦æ™‚é–“): åˆ†å˜ä½ï¼ˆä¾‹ï¼šâ±ï¸ 60 = 60åˆ†ï¼‰
- `ğŸ“…` (æ—¥ä»˜): Tasksãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ¨™æº–æ—¥ä»˜
- `#ã‚¸ãƒ£ãƒ³ãƒ«`: ã‚¿ã‚°ã§ã‚¸ãƒ£ãƒ³ãƒ«ã‚’ç®¡ç†
  - `#ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚¯`
  - `#å£²å ´ä½œæ¥­`
  - `#é¡§å®¢å¯¾å¿œ`
  - `#å®šå‹ä½œæ¥­`
  - `#å­¦ç¿’`
  - `#å¥åº·`
  - `#è¶£å‘³`
- `#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå`: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£ä»˜ã‘

### 1.2 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
ğŸ“ ã‚¿ã‚¹ã‚¯ç®¡ç†/
  â”œâ”€â”€ ğŸ“ ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«/ (æ—¢å­˜)
  â”‚   â””â”€â”€ YYYY-MM-DD.md (æ—¥æ¬¡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«)
  â”œâ”€â”€ ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ/
  â”‚   â””â”€â”€ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå.md
  â”‚       - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
  â”‚       - ã‚µãƒ–ã‚¿ã‚¹ã‚¯ï¼ˆ1éšå±¤ã¾ã§ï¼‰
  â”œâ”€â”€ ğŸ“ ã‚¿ã‚¹ã‚¯ãƒ—ãƒ¼ãƒ«/
  â”‚   â””â”€â”€ ã‚¿ã‚¹ã‚¯ãƒ—ãƒ¼ãƒ«.md (æœªã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¿ã‚¹ã‚¯)
  â”œâ”€â”€ ğŸ“ ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯/
  â”‚   â”œâ”€â”€ æ¯æ—¥.md
  â”‚   â”œâ”€â”€ æ¯é€±.md
  â”‚   â””â”€â”€ æ¯æœˆ.md
  â”œâ”€â”€ ğŸ“„ ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰.md (NEW)
  â”œâ”€â”€ ğŸ“„ é€±å‹¤å‹™ã‚°ãƒªãƒƒãƒ‰.md (æ—¢å­˜ - å‡ºå‹¤æ—¥ãƒªã‚¹ãƒˆ)
  â””â”€â”€ ğŸ“„ è¦ä»¶å®šç¾©.md
```

## 2. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³åˆ¥å®Ÿè£…è©³ç´°

### 2.1 Tasks ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š

#### ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©
```yaml
# .obsidian/tasks.json ã¾ãŸã¯ Tasksè¨­å®š
customFields:
  - name: "æ‰€è¦æ™‚é–“"
    type: "number"
    label: "â±ï¸"
    unit: "åˆ†"
```

#### ã‚¿ã‚¹ã‚¯æ¤œç´¢ã‚¯ã‚¨ãƒªä¾‹
```
# Tasksãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚¯ã‚¨ãƒª
task includes â±ï¸
task includes ğŸ“…
group by date
sort by date
```

### 2.2 QuickAdd ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š

#### ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆMacroï¼‰
```javascript
// QuickAdd Macro: ã‚¿ã‚¹ã‚¯è¿½åŠ 
const taskName = await QuickAdd.api.inputPrompt("ã‚¿ã‚¹ã‚¯å");
const duration = await QuickAdd.api.suggester(
  ["15åˆ†", "30åˆ†", "45åˆ†", "60åˆ†", "90åˆ†", "120åˆ†", "150åˆ†", "180åˆ†", "240åˆ†", "300åˆ†"],
  [15, 30, 45, 60, 90, 120, 150, 180, 240, 300]
);
const genre = await QuickAdd.api.suggester(
  ["ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚¯", "å£²å ´ä½œæ¥­", "é¡§å®¢å¯¾å¿œ", "å®šå‹ä½œæ¥­", "å­¦ç¿’", "å¥åº·", "è¶£å‘³"],
  ["ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚¯", "å£²å ´ä½œæ¥­", "é¡§å®¢å¯¾å¿œ", "å®šå‹ä½œæ¥­", "å­¦ç¿’", "å¥åº·", "è¶£å‘³"]
);
const date = await QuickAdd.api.inputPrompt("æ—¥ä»˜ (YYYY-MM-DD)", moment().format("YYYY-MM-DD"));

// å®¹é‡ãƒã‚§ãƒƒã‚¯
const dailyTasks = await getDailyTasks(date);
const totalMinutes = dailyTasks.reduce((sum, t) => sum + getDuration(t), 0);
const newTotal = totalMinutes + duration;

if (newTotal > 300) {
  const shouldContinue = await QuickAdd.api.yesNoPrompt(
    `å®¹é‡è¶…éè­¦å‘Š: ${newTotal}åˆ†ï¼ˆä¸Šé™300åˆ†ï¼‰\nç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ`
  );
  if (!shouldContinue) return;
}

// ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 
const taskFile = await app.vault.getAbstractFileByPath(`03.ãƒ„ã‚§ãƒƒãƒ†ãƒ«ã‚«ã‚¹ãƒ†ãƒ³/030.ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹/ã‚¿ã‚¹ã‚¯ç®¡ç†/ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«/${date}.md`);
const taskLine = `- [ ] ${taskName} #${genre} â±ï¸ ${duration} ğŸ“… ${date}\n`;
await app.vault.append(taskFile, taskLine);
```

#### ã‚¿ã‚¹ã‚¯ç§»å‹•ã‚³ãƒãƒ³ãƒ‰ï¼ˆMacroï¼‰
```javascript
// QuickAdd Macro: æ¬¡ã®æ—¥ã«ç§»å‹•
const today = moment().format("YYYY-MM-DD");
const tomorrow = moment().add(1, 'day').format("YYYY-MM-DD");

// å‡ºå‹¤æ—¥ãƒªã‚¹ãƒˆã‚’ç¢ºèª
const workDays = await getWorkDays(); // é€±å‹¤å‹™ã‚°ãƒªãƒƒãƒ‰ã‹ã‚‰å–å¾—
const nextWorkDay = findNextWorkDay(tomorrow, workDays);

// ã‚¿ã‚¹ã‚¯ã‚’ç§»å‹•
await moveTaskToDate(today, nextWorkDay);
```

### 2.3 Templater ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š

#### ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯å±•é–‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```javascript
// Templater: é€±å§‹ã‚ã«å®Ÿè¡Œï¼ˆcronè¨­å®šï¼‰

```

### 2.4 Buttons ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š

#### ãƒœã‚¿ãƒ³å®šç¾©
```markdown
```button
name ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ 
type note(ã‚¿ã‚¹ã‚¯ç®¡ç†/ã‚¿ã‚¹ã‚¯ãƒ—ãƒ¼ãƒ«) template
action ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
templater true
```

```button
name æ¬¡ã®æ—¥ã«ç§»å‹•
type command
action QuickAdd: ã‚¿ã‚¹ã‚¯ç§»å‹•
```

### 2.5 Dataview ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š

#### ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
```dataviewjs
// ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯
const today = moment().format("YYYY-MM-DD");
const todayTasks = dv.pages('"ã‚¿ã‚¹ã‚¯ç®¡ç†/ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«"')
  .file.tasks
  .where(t => t.due?.format("YYYY-MM-DD") === today)
  .where(t => t.text.includes("â±ï¸"));

// å®¹é‡è¨ˆç®—
const totalMinutes = todayTasks
  .map(t => parseInt(t.text.match(/â±ï¸ (\d+)/)?.[1] || 0))
  .reduce((sum, m) => sum + m, 0);

// ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥é›†è¨ˆ
const genreBreakdown = {};
todayTasks.forEach(t => {
  const genre = t.tags.find(tag => ["ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚¯", "å£²å ´ä½œæ¥­", "é¡§å®¢å¯¾å¿œ", "å®šå‹ä½œæ¥­"].includes(tag));
  const duration = parseInt(t.text.match(/â±ï¸ (\d+)/)?.[1] || 0);
  if (genre) {
    genreBreakdown[genre] = (genreBreakdown[genre] || 0) + duration;
  }
});

// è¡¨ç¤º
dv.header(3, "ä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯");
dv.table(["ã‚¿ã‚¹ã‚¯", "ã‚¸ãƒ£ãƒ³ãƒ«", "æ™‚é–“"], 
  todayTasks.map(t => [
    t.text.replace(/â±ï¸ \d+/, "").replace(/ğŸ“… \d{4}-\d{2}-\d{2}/, ""),
    t.tags.find(tag => ["ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚¯", "å£²å ´ä½œæ¥­", "é¡§å®¢å¯¾å¿œ", "å®šå‹ä½œæ¥­"].includes(tag)) || "-",
    `${parseInt(t.text.match(/â±ï¸ (\d+)/)?.[1] || 0)}åˆ†`
  ])
);

dv.paragraph(`**å®¹é‡ä½¿ç”¨çŠ¶æ³**: ${totalMinutes}åˆ† / 300åˆ† (${Math.round(totalMinutes/300*100)}%)`);

dv.header(4, "ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥æ§‹æˆæ¯”");
dv.table(["ã‚¸ãƒ£ãƒ³ãƒ«", "æ™‚é–“", "æ§‹æˆæ¯”"], 
  Object.entries(genreBreakdown).map(([genre, minutes]) => [
    genre,
    `${minutes}åˆ†`,
    `${Math.round(minutes/totalMinutes*100)}%`
  ])
);
```

## 3. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Phase 1: åŸºç›¤æ§‹ç¯‰
1. [ ] Tasksãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
2. [ ] ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã®ä½œæˆ
3. [ ] ã‚¸ãƒ£ãƒ³ãƒ«ã‚¿ã‚°ã®å®šç¾©
4. [ ] ã‚¿ã‚¹ã‚¯ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®çµ±ä¸€

### Phase 2: ã‚¿ã‚¹ã‚¯è¿½åŠ æ©Ÿèƒ½
5. [ ] QuickAddã§ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
6. [ ] å®¹é‡ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½ã®å®Ÿè£…
7. [ ] ã‚¿ã‚¹ã‚¯ãƒ—ãƒ¼ãƒ«æ©Ÿèƒ½ã®å®Ÿè£…

### Phase 3: ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯
8. [ ] ç¹°ã‚Šè¿”ã—ã‚¿ã‚¹ã‚¯å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
9. [ ] Templaterã§è‡ªå‹•å±•é–‹æ©Ÿèƒ½å®Ÿè£…
10. [ ] å‡ºå‹¤æ—¥é€£å‹•æ©Ÿèƒ½å®Ÿè£…

### Phase 4: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†
11. [ ] ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ä½œæˆ
12. [ ] ã‚µãƒ–ã‚¿ã‚¹ã‚¯å±•é–‹æ©Ÿèƒ½å®Ÿè£…
13. [ ] é€²æ—ç®¡ç†æ©Ÿèƒ½å®Ÿè£…

### Phase 5: ã‚¿ã‚¹ã‚¯ç§»å‹•ãƒ»å»¶æœŸ
14. [ ] ã‚¿ã‚¹ã‚¯ç§»å‹•ã‚³ãƒãƒ³ãƒ‰å®Ÿè£…
15. [ ] å‡ºå‹¤æ—¥é€£å‹•ç§»å‹•æ©Ÿèƒ½å®Ÿè£…
16. [ ] Buttonsã§æ“ä½œãƒœã‚¿ãƒ³ä½œæˆ

### Phase 6: å¯è¦–åŒ–
17. [ ] ã‚¿ã‚¹ã‚¯ç®¡ç†ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä½œæˆ
18. [ ] å®¹é‡ä½¿ç”¨çŠ¶æ³ã®å¯è¦–åŒ–
19. [ ] ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥æ§‹æˆæ¯”ã®å¯è¦–åŒ–
20. [ ] ãƒ¢ãƒã‚¤ãƒ«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰çµ±åˆ

## 4. æŠ€è¡“çš„ãªå®Ÿè£…è©³ç´°

### 4.1 å‡ºå‹¤æ—¥ãƒªã‚¹ãƒˆã®å–å¾—
```javascript
// é€±å‹¤å‹™ã‚°ãƒªãƒƒãƒ‰ã‹ã‚‰å‡ºå‹¤æ—¥ã‚’å–å¾—
async function getWorkDays() {
  const gridFile = await app.vault.getAbstractFileByPath(
    "03.ãƒ„ã‚§ãƒƒãƒ†ãƒ«ã‚«ã‚¹ãƒ†ãƒ³/030.ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹/ã‚¿ã‚¹ã‚¯ç®¡ç†/é€±å‹¤å‹™ã‚°ãƒªãƒƒãƒ‰.md"
  );
  const content = await app.vault.read(gridFile);
  // é€±å‹¤å‹™ã‚°ãƒªãƒƒãƒ‰ã®å†…å®¹ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦å‡ºå‹¤æ—¥ã‚’æŠ½å‡º
  // å®Ÿè£…ã¯é€±å‹¤å‹™ã‚°ãƒªãƒƒãƒ‰ã®æ§‹é€ ã«ä¾å­˜
}
```

### 4.2 å®¹é‡ãƒã‚§ãƒƒã‚¯
```javascript
async function checkCapacity(date, newDuration) {
  const tasks = await getDailyTasks(date);
  const totalMinutes = tasks.reduce((sum, t) => sum + getDuration(t), 0);
  return {
    total: totalMinutes,
    available: 300 - totalMinutes,
    willExceed: (totalMinutes + newDuration) > 300
  };
}
```

### 4.3 æ¬¡ã®å‡ºå‹¤æ—¥ã®æ¤œç´¢
```javascript
function findNextWorkDay(startDate, workDays) {
  let current = moment(startDate);
  for (let i = 0; i < 14; i++) { // 2é€±é–“å…ˆã¾ã§
    current.add(1, 'day');
    if (workDays.includes(current.format("YYYY-MM-DD"))) {
      return current.format("YYYY-MM-DD");
    }
  }
  return null;
}
```

## 5. æ³¨æ„äº‹é …

- Tasksãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦å®Ÿè£…æ–¹æ³•ãŒç•°ãªã‚‹
- QuickAddã®Macroã¯ã€Obsidianã®APIã«ä¾å­˜ã™ã‚‹ãŸã‚ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§ã«æ³¨æ„
- å‡ºå‹¤æ—¥ãƒªã‚¹ãƒˆã®å–å¾—æ–¹æ³•ã¯ã€é€±å‹¤å‹™ã‚°ãƒªãƒƒãƒ‰ã®å®Ÿè£…ã«ä¾å­˜
- å®¹é‡ãƒã‚§ãƒƒã‚¯ã¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«æ³¨æ„

